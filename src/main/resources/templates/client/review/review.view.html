<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì¥ë‹˜ - ë¦¬ë·° ìƒì„¸ë³´ê¸°</title>
    <!-- Include:ê³µí†µ CSS -->
    <th:block th:include="inc/common/common-css :: commonCss"></th:block>
    <!-- Include:Client CSS -->
    <th:block th:include="inc/client/client-css :: clientCss"></th:block>
    <!-- Include:ê³µí†µ JS -->
    <th:block th:include="inc/common/common-js :: commonJs"></th:block>
    <!-- Include:Client JS -->
    <th:block th:include="inc/client/client-js :: clientJs"></th:block>

    <script>
        // ë¦¬ë·° ì‹ ê³ ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
        function reportReview(reviewKey, element) {
            if (confirm("ì •ë§ ì‹ ê³ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { // í™•ì¸ ì°½ í‘œì‹œ
                $.ajax({
                    type: "POST",
                    url: "/client/reviewReport/" + reviewKey,
                    success: function(response) {
                        if (response.status === "success") {
                            $(element).text("ì‹ ê³  ì™„ë£Œ");
                            $(element).css("pointer-events", "none"); // ë²„íŠ¼ ë¹„í™œì„±í™”
                        } else if (response.status === "already_reported") {
                            alert("ì´ë¯¸ ì‹ ê³ ëœ ë¦¬ë·°ì…ë‹ˆë‹¤.");
                        } else {
                            alert("ì‹ ê³  ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                        }
                    },
                    error: function(xhr, status, error) {
                        alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                    }
                });

            }
        }
    </script>
</head>
<body>
<div class="client-wrap">
    <!-- Start:Aside -->
    <th:block th:include="inc/client/aside :: clientAside"></th:block>
    <!-- End:Aside -->

    <!-- Start:Main -->
    <main id="mainpage__wrap">
        <!-- Start:Header -->
        <th:block th:include="inc/client/header :: clientHeader"></th:block>
        <!-- End:Header -->

        <!-- Start:Contents -->
        <section class="contents">
            <h3>ê°€ê²Œë³„ ë¦¬ë·° ë³´ê¸°</h3><br>

            <ul>
                <th:block th:each="review : ${reviewList}">
                    <li>
                        <!-- ì‹ ê³  ë²„íŠ¼ -->
                        <a href="javascript:void(0);"
                           th:onclick="'reportReview(' + ${review.reviewKey} + ', this)'"
                           th:text="${review.reportReview ? 'ì‹ ê³  ì™„ë£Œ' : 'ì‹ ê³ ğŸš¨'}"
                           th:style="${review.reportReview ? 'pointer-events: none;' : ''}">
                        </a>

                        <b th:text="${review.userId}"></b>
                        [[${#temporals.format(review.reviewRegdate.toLocalDate(), 'yyyy/MM/dd')}]]
                        <span th:if="${review.reviewComment == null || review.reviewComment.isEmpty()}" th:text="ë¯¸ì‘ì„±"></span>
                        <span th:if="${review.reviewComment != null && !review.reviewComment.isEmpty()}" th:text="ì‘ì„±"></span>
                        <p>ë³„ì  : [[${review.reviewRating}]]</p>
                        <p>[[${review.reviewDesc}]]</p>
                        <p th:if="${review.reviewPhoto1 != null || review.reviewPhoto2 != null}">
                            [[${review.reviewPhoto1}]] [[${review.reviewPhoto2}]]
                        </p>

                        <!-- ì£¼ë¬¸ ëª©ë¡ ë°˜ë³µ -->
                        <p>ì£¼ë¬¸ë©”ë‰´</p>
                        <ul>
                            <th:block th:each="order : ${review.orderList}">
                                <th:block th:each="detail : ${order.clientOrderDetails}">
                                    <li th:if="${review.orderKey == detail.orderKey}">
                                        <span th:text="${detail.menuName}"></span>
                                        <span th:text="${detail.optionName}"></span>
                                        <span th:text="${detail.quantity}"></span>
                                    </li>
                                </th:block>
                            </th:block>
                        </ul>

                        <!-- ì‚¬ì¥ë‹˜ ë‹µë³€ ì—¬ë¶€ì°½ -->
                        <div>
                            <form th:action="@{/client/{action}(action=${review.reviewComment == null || review.reviewComment.isEmpty() ? 'saveComment' : 'updateComment'})}"
                                  method="post">
                                <p th:text="${review.reviewComment == null || review.reviewComment.isEmpty() ? 'ì‚¬ì¥ë‹˜ ë‹µê¸€ë‹¬ê¸°' : 'ì‘ì„±ì¼ì: ' + (review.commentRegdate != null ? #temporals.format(review.commentRegdate.toLocalDate(), 'yyyy/MM/dd') : '')}"></p>
                                <textarea name="comment"
                                          th:attr="readonly=${review.reviewComment != null && !review.reviewComment.isEmpty()}"
                                          th:placeholder="${review.reviewComment == null || review.reviewComment.isEmpty() ? 'ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”' : ''}"
                                          th:text="${review.reviewComment != null ? review.reviewComment : ''}"></textarea>
                                <input type="hidden" name="reviewKey" th:value="${review.reviewKey}"/>
                                <button type="submit"
                                        th:text="${review.reviewComment == null || review.reviewComment.isEmpty() ? 'ì‘ì„±' : 'ìˆ˜ì •'}"></button>
                            </form>
                        </div>

                        <br>
                    </li>
                </th:block>
            </ul>
        </section>
        <!-- End:Contents -->
    </main>
    <!-- End:Main -->
</div>
</body>
</html>